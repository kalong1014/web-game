<!--{template header}-->
<script>
	function register(id, result) {
		if(result) {
			$('registersubmit').disabled = true;
			window.location.href = "$jumpurl";
		} else {
			updateseccode();
		}
	}
</script>
<script type="text/javascript">

    $('#username').focus();
    var lastUserName = lastPassword = lastEmail = lastSecCode = '';
    function checkUserName() {
        var userName = $('#username').val();
        if (userName == lastUserName) {
            return;
        } else {
            lastUserName = userName;
        }
        var cu = $('#checkusername');
        var unLen = userName.replace(/[^\x00-\xff]/g, "**").length;

        if (unLen < 3 || unLen > 15) {
            warning(cu, unLen < 3 ? '用户名小于3个字符' : '用户名超过 15 个字符');
            return;
        }else{
			cu.html('');
			cu.removeClass( "error");
            cu.addClass ("success");
		}
        //ajaxresponse('checkusername', 'op=checkusername&username=' + userName);
        
    }
    function checkPassword(confirm) {
        var password = $('#password').val();
        if (!confirm && password == lastPassword) {
            return;
        } else {
            lastPassword = password;
        }
        var cp = $('#checkpassword');
        if (password == '' || /[\\]/.test(password)) {
            warning(cp, '密码空或包含非法字符');
            return false;
        } else {
            cp.show();
            //cp.innerHTML = '<img src="image/check_right.gif" width="13" height="13">';
            cp.addClass("success");
            if (!confirm) {
                checkPassword2(true);
            }
            return true;
        }
    }
    function checkPassword2(confirm) {
        var password = $('#password').val();
        var password2 = $('#password2').val();
        var cp2 = $('#checkpassword2');
        if (password2 != '') {
            checkPassword(true);
        }
        if (password == '' || (confirm && password2 == '')) {
            cp2.hide();
            return;
        }
        if (password != password2) {
            warning(cp2, '两次输入的密码不一致');
        } else {
            cp2.show();

            cp2.html('');
			cp2.removeClass("error");
            cp2.addClass ("success");
        }
    }
    function checkSeccode() {
        var seccodeVerify = $('#seccode').val();
        ajaxresponse('checkseccode', 'op=checkseccode&seccode=' + (is_ie && document.charset == 'utf-8' ? encodeURIComponent(seccodeVerify) : seccodeVerify));
    }

    function checkEmail() {
        var cp2 = $('#checkEmail');
        var email = $('#email').val();
        res = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
        var re = new RegExp(res);
        if (email.match(re) == null) {
            cp2.show();
            cp2.addClass( "error");
            cp2.html('请输入正确的Email地址');

        } else {
            cp2.show();
           // cp2.html('');
		    cp2.removeClass( "error");
            cp2.addClass("success");
        }

    }

	function ajaxresponse(objname, data) {
		var x = new Ajax('XML', objname);
		x.get('index.php?ac=register&' + data, function(s){
			var obj = $(objname);
			s = trim(s);
			if(s.indexOf('succeed') > -1) {
				obj.style.display = '';
				obj.innerHTML = '<img src="image/check_right.gif" width="13" height="13">';
				obj.className = "warning";
			} else {
				warning(obj, s);
			}
		});
	}
    
    function warning(obj, msg) {
        if ((ton = obj.attr("id").substr(5, obj.attr("id").length)) != 'password2') {
            $(ton).select();
        }
        obj.show();
        obj.html('&nbsp; ' + msg);
        obj.removeClass("success");
        obj.addClass("error");
    }

    function checkPwd(pwd) {

        if (pwd == "") {
            $("#checkpassword").className = "";
            $("#checkpassword").html("");
        } else if (pwd.length < 3) {
            $("#checkpassword").addClass("error");
            $("#checkpassword").html("&nbsp;&nbsp;太短");
        } else if (!isPassword(pwd) || !/^[^%&]*$/.test(pwd)) {
            $("#checkpassword").className = "";
            $("#checkpassword").html("");
        } else {
            var csint = checkStrong(pwd);
            switch (csint) {
                case 1:
                    $("#checkpassword").html("&nbsp;&nbsp;很弱");
					$("#checkpassword").removeClass("error");
                    $("#checkpassword").addClass("success");
                    break;
                case 2:
                    $("#checkpassword").html("&nbsp;&nbsp;一般");
					$("#checkpassword").removeClass("error");
                    $("#checkpassword").addClass("success");
                    break;
                case 3:
                    $("#checkpassword").html("&nbsp;&nbsp;很强");
					$("#checkpassword").removeClass("error");
                    $("#checkpassword").addClass("success");
                    break;
            }
        }
    }
    function isPassword(str) {
        if (str.length < 3) return false;
        var len;
        var i;
        len = 0;
        for (i = 0; i < str.length; i++) {
            if (str.charCodeAt(i) > 255) return false;
        }
        return true;
    }
    function charMode(iN) {
        if (iN >= 48 && iN <= 57) //数字 
            return 1;
        if (iN >= 65 && iN <= 90) //大写字母 
            return 2;
        if (iN >= 97 && iN <= 122) //小写 
            return 4;
        else
            return 8; //特殊字符 
    }
    //计算出当前密码当中一共有多少种模式 
    function bitTotal(num) {
        modes = 0;
        for (i = 0; i < 4; i++) {
            if (num & 1) modes++;
            num >>>= 1;
        }
        return modes;
    }

    //返回密码的强度级别 
    function checkStrong(pwd) {
        modes = 0;
        for (i = 0; i < pwd.length; i++) {
            //测试每一个字符的类别并统计一共有多少种模式. 
            modes |= charMode(pwd.charCodeAt(i));
        }
        return bitTotal(modes);
    }
    //验证码
    function seccode() {
        var img = 'index.php?ac=seccode&rand=' + Math.random();
        document.writeln('<img id="img_seccode" src="' + img + '" align="absmiddle">');
		
    }
    function updateseccode() {
        var img = 'index.php?ac=seccode&rand=' + Math.random();
        if ($('#img_seccode')) {        　
            $("#img_seccode").attr("src", img);         
        }
    }
	var usetime="$_SCONFIG[usetime]";
    var count_time= 60*parseInt(usetime);//定义规定的时间，60秒后再次发送
    function start_timer(){
		if(count_time == 0){
            $('#dxbtn').removeAttr("disabled");
            $('#dxbtn').val("重新发送");
            count_time= 60*parseInt(usetime);
        }else{
            $('#dxbtn').attr("disabled",true);
            $('#dxbtn').val("重新发送("+count_time+")");
            count_time--;
            setTimeout(function(){start_timer();},1000);
        }
    }
	function checkmobile(mobile){
		var ismobile = RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|14[57])[0-9]{8}$/).test(mobile); 
		if (ismobile) {
			$('#chkmobilemsg').html('');
			$('#username').val(mobile);
			$('#dxbtn').attr("disabled",false);
		} else {
			$('#chkmobilemsg').html('	请填写正确的手机号码');
			$('#chkmobile').val('');
			$('#dxbtn').attr("disabled",true);
			return;
		}
	}
	function sendmessage(){
		var mobile=$('#chkmobile').val();
		$.ajax({
				type:"GET",
				url:'/index.php?ac=sendmsg&op=reg&mobile='+mobile,
				dataType:'json',
				success:function(data){
					if(data.status==1){
						alert(data.msg);
					}else{
						alert('发送失败');
					}
				}
		})
		start_timer();
	}
	function checkidnumber() { 
			var code=$('#idnumber').val();
            var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
            var tip = "";
            var pass= true;
            
            if(!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12]|10)(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
                tip = "身份证号格式错误";
                pass = false;
            }
            
           else if(!city[code.substr(0,2)]){
                tip = "地址编码错误";
                pass = false;
            }
            else{
                //18位身份证需要验证最后一位校验位
                if(code.length == 18){
                    code = code.split('');
                    //∑(ai×Wi)(mod 11)
                    //加权因子
                    var factor = [ 7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2 ];
                    //校验位
                    var parity = [ 1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2 ];
                    var sum = 0;
                    var ai = 0;
                    var wi = 0;
                    for (var i = 0; i < 17; i++)
                    {
                        ai = code[i];
                        wi = factor[i];
                        sum += ai * wi;
                    }
                    var last = parity[sum % 11];
                    if(parity[sum % 11] != code[17]){
                        tip = "校验位错误";
                        pass =false;
                    }
                }
            }
           
			var cu = $('#checkidnumber');
			if (pass) {
				cu.show();
				cu.html('');
				cu.attr('class','success');
				cu.addClass("success");
			} else {
				cu.show();
				cu.addClass( "error");
				cu.html(tip);
			}
        }
		function checkRealName() {
        var realname = $('#realname').val();
		res = /^[\u4e00-\u9fa5]{2,4}$/;
		var re = new RegExp(res);
        var cu = $('#checkrealname');
        if (realname.match(re) == null) {
            cu.show();
            cu.addClass( "error");
            cu.html('请输入真实姓名（由 2~4 个汉字组成）');

        } else {
            cu.show();
			cu.html('');
            cu.attr('class','success');
            //cu.addClass("success");
        }
        
    }
	function chkregform(reg){
		var hval="";
		var herror="";
		 $(".loginform span").each(function(){
			if($(this).attr('class').indexOf("error") > 0){
				herror="error";
				return false;
				
			}
		 });
		 if(herror){
		 	 alert('页面提交的信息存在错误');
		     return false;
		 }
	}
</script>
<div class="layout logreg clearfix">
  <ul class="logreg_nav">
      <li><a href="index.php?ac=login<!--{if $type}-->&type=$type<!--{else}--><!--{/if}-->">用户登录</a></li>
      <li><a href="index.php?ac=register<!--{if $type}-->&type=$type<!--{else}--><!--{/if}-->" class="dangqian">用户注册</a></li>
      <li><a href="index.php?ac=lostpasswd<!--{if $type}-->&type=$type<!--{else}--><!--{/if}-->">找回密码</a></li>
  </ul>
  <div id="reg-form" class="logreg_con">
    <h2>用户注册</h2>
    <form name="registerform" action="index.php?ac=register&$url_plus&ref" method="post" class="loginform" id="register1" onSubmit="return chkregform('register1')" >
      <ul class="form-list">
	  	<!--{if $_SCONFIG[kqdxyz]}-->
		<li><label for="chkmobile" class="mn_infobox">账号：</label><input type="text" id="chkmobile" name="chkmobile" value="" class="text-input chkmobile2_{$_SC['siteid']}" tabindex="6" onblur="checkmobile(this.value)" /><span id="chkmobilemsg">请输入手机号</span></li>
		<input type="hidden" id="username" name="username" value="">
		<li><label class="mn_infobox"></label><input type="button" id="dxbtn" value="发送短信" onclick="sendmessage()" disabled=""></li>
		<li><label for="chkmobilenum" class="mn_infobox">手机验证码：</label><input type="text" id="chkcode" name="mobilecode" value="" class="text-input" tabindex="7" /><span>请输入手机验证码</span></li>
		<!--{else}-->
        <li><label for="username" class="mn_infobox">账号：</label><input type="text" id="username" name="username" value="" class="text-input name3_{$_SC['siteid']}" onblur="checkUserName()" tabindex="2" /><span id="checkusername" class="checkname_{$_SC['siteid']}" ></span></li>
        <!--{/if}-->
		<li><label for="password" class="mn_infobox">密码：</label><input type="password" name="password" id="password" value="" class="text-input txtpass_{$_SC['siteid']}" onblur="checkPassword()" onkeyup="checkPwd(this.value);" tabindex="3" /><span id="checkpassword"></span></li>
        <li><label for="password2" class="mn_infobox">确认密码：</label><input type="password" id="password2" name="password2" value="" class="text-input pass2_{$_SC['siteid']}" onblur="checkPassword2()" tabindex="4" /><span id="checkpassword2"></span></li>
		<!--{if $_SCONFIG[kqyouxiang]}-->
        <li><label for="email" class="mn_infobox">邮件地址：</label><input type="text" id="email" name="email" value="" class="text-input email2_{$_SC['siteid']}" tabindex="5" onblur="checkEmail()" /><span id="checkEmail">输入常用有邮箱</span></li>
		<!--{/if}-->
		<!--{if $_SCONFIG['shimingrenzheng']}-->
		<li style="margin-left: 150px;">根据国家相关规定，网络游戏用户需使用有效身份证件进行实名注册。</li>
		<li><label for="username" class="mn_infobox">真实姓名：</label><input type="text" id="realname" name="realname" value="" class="text-input realname3_{$_SC['siteid']}" onblur="checkRealName()" tabindex="7" /><span id="checkrealname" class="checkrealname_{$_SC['siteid']}" >请填写真实姓名</span></li>
		<li><label for="idnumber" class="mn_infobox">身份证号：</label><input type="text" id="idnumber" name="idnumber" value="" class="text-input idnumber3_{$_SC['siteid']}" onblur="checkidnumber()" tabindex="8" /><span id="checkidnumber" class="checkidnumber_{$_SC['siteid']}" >请准确填写身份证号码</span></li>
		<!--{/if}-->
        <!--{if $_SCONFIG['qiyongyzm']}-->
        <li class="reg_yzm"><label for="seccode" class="mn_infobox">验证码：</label><input type="text" id="seccode" name="seccode" value="" class="text-input seccode2_{$_SC['siteid']}" tabindex="8" onblur="checkSeccode()" autocomplete="off" /><script>seccode();</script><a href="javascript:updateseccode()">换一张?</a><span id="checkseccode"></span></li>
        <!--{/if}-->

                <li class="plwid">                 
                    <input type="hidden" name="refer" value="/" />
                    <input type="hidden" name="formhash" value="<!--{eval echo formhash();}-->" />
                    <input type="submit" id="registersubmit" name="registersubmit" value="立即注册" class="tijiao" />
                </li>
            </ul>
        </form>
    </div>
</div>
<!--{template footer}-->